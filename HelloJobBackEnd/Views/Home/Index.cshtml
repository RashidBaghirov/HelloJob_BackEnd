@{
    ViewBag.Title = "Hello page";
    List<Company> companies = ViewBag.Company;
}

@model  List<Vacans>
@if (TempData["Register"] != null)
{
    if ((bool)TempData["Register"] == true)
    {
        <input type="hidden" id="registerSuccess" />
    }
    else
    {
        <input type="hidden" id="registerError" />

    }
}
@if (TempData["Login"] != null)
{
    if ((bool)TempData["Login"] == true)
    {
        <input type="hidden" id="loginSuccess" />
    }
    else
    {
        <input type="hidden" id="loginError" />

    }
}
@if (TempData["ForgotPassword"] != null)
{
    if ((bool)TempData["ForgotPassword"] == true)
    {
        <input type="hidden" id="forgotSuccess" />
    }
    else
    {
        <input type="hidden" id="forgotError" />
    }
}
@if (TempData["Security"] != null)
{
    if ((bool)TempData["Security"] == true)
    {
        <input type="hidden" id="securitySuccess" />
    }
    else
    {
        <input type="hidden" id="securityError" />
    }
}



<section id="titles_and_bgblue">
    <div class="blueback">
    </div>
    <div class="container">
        <div class="row">
            <div class="titles col-lg-12 col-md-12">
                <ul>
                    <li>
                        <a asp-controller="home" asp-action="index">İş elanları</a>
                    </li>
                    <li>
                        <a asp-controller="cvpage" asp-action="index">CV-lər</a>
                    </li>
                </ul>
            </div>
            <div class="search_titles_bottom col-lg-12 col-md-12">
                <div class="searchbar full">
                    <div class="searchbar_top" style="display: flex;">
                        <form method="post" action="#" class="search">
                            <div class="input">
                                <input type="text" name="search" class="search-input" placeholder="Vəzifəyə uyğun vakansiya axtarın...." autocomplete="off">
                            </div>
                            <button type="submit" class="search_btn"><span>Axtar</span></button>
                        </form>
                      
               
                    </div>
                   
                </div>
                <div class="search-results d-block"></div>
            </div>
        </div>
    </div>
</section>
<section id="sliders">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <div class="title">
                    <h1>
                        İş elanları 2023
                    </h1>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="responsive">
                    @if (User.Identity.IsAuthenticated && User.IsInRole(UserRole.employeer.ToString()))
                    {
                        <div class="item">
                            <div class="new-cat-card apply-cv">
                                <a asp-controller="myaccount" asp-action="createcv">
                                    <img src="https://www.hellojob.az/content/assets/images/vacancies/upload.svg">
                                    <div class="new-cat-name"><p>CV əlavə et</p></div>
                                    <div class="new-cat-count"><p>Şirkətlər sizi tapsın</p></div>
                                </a>
                            </div>
                        </div>
                    }
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/maliyye-cat-6414340658330641434065833b-26NMIAq7bV3-yXq.svg" alt="Maliyyə">
                                <div class="new-cat-name"><p>Maliyyə</p></div>
                                <div class="new-cat-count"><p><span>105</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/marketinq-cat-641433fe9e5c6641433fe9e5d3-rKuhtYV5f4UPa85.svg" alt="Marketinq">
                                <div class="new-cat-name"><p>Marketinq</p></div>
                                <div class="new-cat-count"><p><span>20</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/texnologiya-cat-641433be8b37d641433be8b38e-e9_0BJdsJbmUnVB.svg" alt="Texnologiya">
                                <div class="new-cat-name"><p>Texnologiya</p></div>
                                <div class="new-cat-count"><p><span>48</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/satis-cat-64143417860756414341786081-vC1K1njTVifH3Sh.svg" alt="Satış">
                                <div class="new-cat-name"><p>Satış</p></div>
                                <div class="new-cat-count"><p><span>42</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="/is-elanlari/dizayn">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/dizayn-cat-64143423043a064143423043ab-dW7E0i95SRjZ4mG.svg" alt="Dizayn">
                                <div class="new-cat-name"><p>Dizayn</p></div>
                                <div class="new-cat-count"><p><span>6</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/muxtelif-cat-6414343d74be26414343d74bed-Q30Ca59zmtb--84.svg" alt="Müxtəlif">
                                <div class="new-cat-name"><p>Müxtəlif</p></div>
                                <div class="new-cat-count"><p><span>11</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/tibb-ve-eczaciliq-cat-6414344d875b26414344d875bd-N7Sq_u6Y1JguQLo.svg" alt="Səhiyyə">
                                <div class="new-cat-name"><p>Səhiyyə</p></div>
                                <div class="new-cat-count"><p><span>5</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/tehsil-ve-elm-cat-6414348e561bd6414348e561cb-lY0Gl-kw9Pyk_kP.svg" alt="Təhsil və elm">
                                <div class="new-cat-name"><p>Təhsil və elm</p></div>
                                <div class="new-cat-count"><p><span>14</span> iş elanı</p></div>
                            </a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="new-cat-card">
                            <a href="">
                                <img src="https://www.hellojob.az/uploads/_categories/2023/03/17/xidmet-cat-6414342ff21226414342ff212e-m10Qat01rxfzfT3.svg" alt="Xidmət">
                                <div class="new-cat-name"><p>Xidmət</p></div>
                                <div class="new-cat-count"><p><span>26</span> iş elanı</p></div>
                            </a>
                        </div>




                    </div>
                </div>
            </div>
        </div>
        </div>
</section>
<section id="works">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <div class="title">
                    <h1>
                        Vakansiyalar
                    </h1>
                </div>
                <div class="row">
                    <div class="col-lg-8 col-md-8">
                        @foreach (Vacans vacans in Model)
                        {
                            <div class="vacancies">
                                <div class="vacancies_href">
                                    <a asp-controller="company" asp-action="vacansdetail" asp-route-id="@vacans.Id">
                                        <div class="item_left">
                                            <div class="icon" style="width: 58px !important; height: auto !important">
                                                <img style="width: 100%; object-fit: contain;" src="~/assets/images/Company/@vacans.Company.Image" alt="@vacans.Company.Name" />
                                            </div>
                                            <div class="title">
                                                <h3 style="position: inherit !important;">@vacans.Position</h3>
                                                <p>@vacans.BusinessArea.Name</p>
                                            </div>
                                        </div>
                                    </a>
                                    <div class="item_right">
                                        <span class="salary">@(vacans.Salary == 0 ? "Ə-h razılaşma ilə" : vacans.Salary) (AZN)</span>
                                        <span class="date">@vacans.CreatedAt.ToString("dd.MM")</span>
                                        <span class="like">
                                            <a class="like-button" data-item-id="@vacans.Id" data-item-type="Vacans">
                                                <i class="fa-regular fa-heart unliked"></i>
                                            </a>
                                            <a class="unliked-button" data-vacans-id="@vacans.Id" data-item-type="Vacans">
                                                <i class="fa-solid fa-heart liked"></i>
                                           </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        }

                     
                    </div>
                    <div class="col-lg-4 col-md-4 mb-3">
                        <div class="sticky_element">
                            <div class="reclams">
                                <img src="https://www.hellojob.az/uploads/banners/2023/05/01/kapital-bank-banner-644f848092e7a-9bb97ce3487c22cc702dcd5e0ccb309f644f848092e8e-aryZtKUi6v_De5r.jpg" alt="">
                            </div>
                            <div class="companies">

                                @foreach (Company item in companies)
                                {
                                    <div class="company">
                                        <a asp-controller="company" asp-action="detail" asp-route-id="@item.Id" class="full">
                                            <div>
                                                <div class="company_images" style="padding:0px !important; position:static !important;">
                                                    <div class="image" style="
                                                                  height: 70px;
                                                                   display: flex;
                                                                   justify-content: center;">
                                                                                                           
                                                        <img src="~/assets/images/Company/@item.Image"
                                                             alt="@item.Name" />
                                                    </div>
                                                </div>
                                                <p style="
                                             display: flex;
                                     justify-content: center;
                                                ">@item.Name</p>
                                                <p>Vakansiya sayı <span>@item.Vacans.Count()</span> </p>
                                            </div>
                                        </a>
                                    </div>

                                }


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Script{

    <script>

        const searchForm = document.querySelector('.search');
        const searchInput = searchForm.querySelector('.search-input');
        const searchResults = document.querySelector('.search-results');

        searchForm.addEventListener('submit', (e) => {
            const searchQuery = e.target.value.trim();
            e.preventDefault();
            window.location.href = "/Home/Index?search=${searchQuery}";
        });

        let timeoutId;

        searchInput.addEventListener('input', (e) => {
            const searchQuery = e.target.value.trim();
            if (searchQuery.length < 2) {
                searchResults.innerHTML = '';
                return;
            }
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                fetch(`/Home/Search?search=${searchQuery}`)
                    .then(response => response.text())
                    .then(data => {
                        searchResults.innerHTML = data;
                    })
                    .catch(error => console.log(error));
            }, 500);
        });

       


    </script>
    <script>
        $(document).ready(function () {
            if ($("#registerSuccess").length) {
                toastr["success"]("You have successfully joined us!", "Hello,Please check your register email" )
            }
            else if ($("#registerError").length) {
                toastr["error"]("Something went wrong!", "Upsss Sorry")
            }
        })
    </script>
    <script>
        $(document).ready(function () {
            if ($("#loginSuccess").length) {
                toastr["success"]("Welcome back to us!", "Hello")
            }
            else if ($("#loginError").length) {
                toastr["error"]("Username or password is incorrect!", "Upsss Sorry")
            }
        })
    </script>
    <script>
        $(document).ready(function () {
            if ($("#forgotSuccess").length) {
                toastr["success"]("You have successfully joined us!", "Hello,Please check your register email")
            }
            else if ($("#forgotError").length) {
                toastr["error"]("Something went wrong!", "Upsss Sorry")
            }
        })
    </script>
    <script>
        $(document).ready(function () {
            if ($("#securitySuccess").length) {
                toastr["success"]("You have successfully joined us!", "Hello,Your Password or Username Changed")
            }
            else if ($("#securityError").length) {
                toastr["error"]("Something went wrong!", "Upsss Sorry")
            }
        })
    </script>
}